"use strict";(self.webpackChunkreal_estate=self.webpackChunkreal_estate||[]).push([[854],{9854:(e,o,l)=>{l.r(o),l.d(o,{default:()=>S});var r=l(9379),s=l(5043),t=l(3216),i=l(5766),a=l.n(i),n=l(1206),d=l(4450),c=l(4626),u=l(2554),v=l(3516),p=l(6305),m=l(2145),f=l(6178),h=l.n(f),y=l(9223),x=l.n(y),b=l(216),g=l(579);const S=function(){var e;const o=(0,t.zy)(),{fileData:l,customFields:i}=o.state||{},[f,y]=(0,s.useState)([]),[S,w]=((0,n.dU)("gray.200","whiteAlpha.100"),(0,s.useState)([])),[j,C]=(0,s.useState)(!1),F=(0,t.Zp)(),[k,I]=(null===(e=JSON.parse(localStorage.getItem("user")))||void 0===e||e._id,(0,s.useState)([])),E=Object.fromEntries((i||[]).map((e=>[null===e||void 0===e?void 0:e.name,""]))),H=(0,r.A)({},E),A=[...null===i||void 0===i?void 0:i.map((e=>{var o;return{Header:null===e||void 0===e?void 0:e.label,accessor:null===e||void 0===e?void 0:e.name,type:null===e||void 0===e?void 0:e.type,formikType:null===e||void 0===e||null===(o=e.validations)||void 0===o?void 0:o.find((e=>e.hasOwnProperty("formikType")))}}))],G=(0,v.Wx)({initialValues:H,onSubmit:(e,o)=>{let{resetForm:l}=o;const r=null===S||void 0===S?void 0:S.map(((o,l)=>{const r={createdDate:new Date,deleted:o[e.deleted||"deleted"]||!1,createBy:JSON.parse(localStorage.getItem("user"))._id};return null===A||void 0===A||A.forEach((l=>{var s,t,i,a;const n=e[null===l||void 0===l?void 0:l.accessor],d=o[n]||"";"date"===(null===l||void 0===l||null===(s=l.type)||void 0===s?void 0:s.toLowerCase())?r[null===l||void 0===l?void 0:l.accessor]=h()(d).isValid()?d:"":"number"===(null===l||void 0===l||null===(t=l.type)||void 0===t?void 0:t.toLowerCase())&&["positive","negative"].includes(null===l||void 0===l||null===(i=l.formikType)||void 0===i?void 0:i.toLowerCase())?r[null===l||void 0===l?void 0:l.accessor]=parseFloat(d)||"":"number"===(null===l||void 0===l||null===(a=l.type)||void 0===a?void 0:a.toLowerCase())?r[null===l||void 0===l?void 0:l.accessor]=parseInt(d,10)||"":r[null===l||void 0===l?void 0:l.accessor]=d})),r}));P(r)}}),{errors:T,touched:B,values:L,handleBlur:O,handleChange:R,handleSubmit:W,setFieldValue:_,resetForm:z}=G,P=async e=>{try{C(!0),200===(await(0,p.d_)("api/property/addMany",e)).status&&(m.oR.success("Properties imported successfully"),z(),F("/properties"))}catch(o){console.error(o),m.oR.error("Properties import failed"),z(),F("/properties")}finally{C(!1)}};return(0,s.useEffect)((()=>{if(l&&l.length>0){(async e=>{const o=new FileReader,l=e.name.split(".").pop().toLowerCase();if(o.onload=async e=>{let{target:o}=e;if("csv"===l){const e=a().parse(o.result,{header:!0}),l=null===e||void 0===e?void 0:e.data;if(l&&l.length>0){w(l);const e=Object.keys(l[0]);y(e)}else m.oR.error("Empty or invalid CSV file"),F("/properties")}else if("xlsx"===l){const e=new Uint8Array(o.result),l=new(x().Workbook);await l.xlsx.load(e);const r=l.getWorksheet(1),s=[];if(r.eachRow({includeEmpty:!0},((e,o)=>{const l={};e.eachCell({includeEmpty:!0},((e,o)=>{l[r.getCell(1,o).value]=e.value})),s.push(l)})),null===s||void 0===s||s.splice(0,1),w(s),s&&s.length>0){const e=Object.keys(s[0]);y(e)}else m.oR.error("Empty or invalid XLSX file"),F("/properties")}},"csv"===l)o.readAsText(e);else if("xlsx"===l){const l=new Blob([e]);o.readAsArrayBuffer(l)}})(l[0])}}),[l]),(0,s.useEffect)((()=>{const e=f.filter((e=>{const o=A.find((o=>e===(null===o||void 0===o?void 0:o.accessor)||e===(null===o||void 0===o?void 0:o.Header)));return!!o&&(_(null===o||void 0===o?void 0:o.accessor,e),!0)}));I(e)}),[f]),(0,g.jsx)(g.Fragment,{children:(0,g.jsxs)(b.A,{overflowY:"auto",className:"importTable",children:[(0,g.jsx)(d.Text,{color:"secondaryGray.900",fontSize:"22px",fontWeight:"700",mb:"20px",children:"Import Properties "}),(0,g.jsx)(d.Grid,{templateColumns:"repeat(12, 1fr)",mb:3,pb:2,gap:1,borderBottom:"1px solid #e2e8f0",children:[{Header:"Fields In Crm",accessor:"crmFields"},{Header:"Fields In File",accessor:"fileFields"}].map(((e,o)=>(0,g.jsx)(d.GridItem,{colSpan:{base:6},fontWeight:"600",fontSize:{sm:"14px",lg:"14px"},color:"secondaryGray.900",style:{textTransform:"uppercase"},children:e.Header},o)))}),(0,g.jsx)(d.Grid,{templateColumns:"repeat(12, 1fr)",mb:3,gap:1,overflowY:"auto",children:null===A||void 0===A?void 0:A.map(((e,o)=>(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(d.GridItem,{colSpan:{base:6},mt:"10px",children:e.Header},e.id),(0,g.jsx)(d.GridItem,{colSpan:{base:4},children:(0,g.jsxs)(c.l6,{variant:"flushed",fontWeight:"500",isSearchable:!0,value:L[e.accessor],name:e.accessor,onChange:R,children:[(0,g.jsxs)("option",{value:"",children:[" ",k&&k.find((o=>(e.Header===o||e.accessor===o)&&o))?k.find((o=>(e.Header===o||e.accessor===o)&&o)):"Select Field In File"]}),"                                        ",null===f||void 0===f?void 0:f.map((e=>(0,g.jsx)("option",{value:e,children:e},e)))]})})]})))}),(0,g.jsx)(d.Flex,{Flex:!0,justifyContent:"end",mt:"5",children:(0,g.jsx)(u.Button,{size:"sm",onClick:()=>W(),variant:"brand",children:"Save"})})]})})}}}]);
//# sourceMappingURL=854.153f7ed3.chunk.js.map