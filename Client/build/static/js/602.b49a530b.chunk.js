"use strict";(self.webpackChunkreal_estate=self.webpackChunkreal_estate||[]).push([[602],{3602:(e,l,o)=>{o.r(l),o.d(l,{default:()=>g});var a=o(9379),s=o(5043),i=o(3216),t=o(5766),r=o.n(t),d=o(4450),n=o(4626),c=o(2554),u=o(3516),v=o(6305),p=o(2145),m=o(6178),f=o.n(m),h=o(9223),x=o.n(h),y=o(216),b=o(579);const g=function(){const e=(0,i.zy)(),{fileData:l,customFields:o}=e.state||{},[t,m]=(0,s.useState)([]),[h,g]=(0,s.useState)([]),[j,w]=(0,s.useState)(!1),S=(0,i.Zp)(),[C,F]=(0,s.useState)([]),k=Object.fromEntries((o||[]).map((e=>[null===e||void 0===e?void 0:e.name,""]))),I=(0,a.A)({},k),L=[...null===o||void 0===o?void 0:o.map((e=>{var l;return{Header:null===e||void 0===e?void 0:e.label,accessor:null===e||void 0===e?void 0:e.name,type:null===e||void 0===e?void 0:e.type,formikType:null===e||void 0===e||null===(l=e.validations)||void 0===l?void 0:l.find((e=>e.hasOwnProperty("formikType")))}}))],E=(0,u.Wx)({initialValues:I,onSubmit:(e,l)=>{let{resetForm:o}=l;const a=null===h||void 0===h?void 0:h.map(((l,o)=>{const a={createdDate:new Date,deleted:l[e.deleted||"deleted"]||!1,createBy:JSON.parse(localStorage.getItem("user"))._id};return null===L||void 0===L||L.forEach((o=>{var s,i,t,r;const d=e[null===o||void 0===o?void 0:o.accessor],n=l[d]||"";"date"===(null===o||void 0===o||null===(s=o.type)||void 0===s?void 0:s.toLowerCase())?a[null===o||void 0===o?void 0:o.accessor]=f()(n).isValid()?n:"":"number"===(null===o||void 0===o||null===(i=o.type)||void 0===i?void 0:i.toLowerCase())&&["positive","negative"].includes(null===o||void 0===o||null===(t=o.formikType)||void 0===t?void 0:t.toLowerCase())?a[null===o||void 0===o?void 0:o.accessor]=parseFloat(n)||"":"number"===(null===o||void 0===o||null===(r=o.type)||void 0===r?void 0:r.toLowerCase())?a[null===o||void 0===o?void 0:o.accessor]=parseInt(n,10)||"":a[null===o||void 0===o?void 0:o.accessor]=n})),a}));z(a)}}),{errors:H,touched:G,values:T,handleBlur:A,handleChange:B,handleSubmit:R,setFieldValue:W,resetForm:O}=E,z=async e=>{try{w(!0),200===(await(0,v.d_)("api/lead/addMany",e)).status&&(p.oR.success("Leads imported successfully"),O(),S("/lead"))}catch(l){console.error(l),p.oR.error("Leads import failed"),O(),S("/lead")}finally{w(!1)}};return(0,s.useEffect)((()=>{if(l&&l.length>0){(async e=>{const l=new FileReader,o=e.name.split(".").pop().toLowerCase();if(l.onload=async e=>{let{target:l}=e;if("csv"===o){const e=r().parse(l.result,{header:!0}),o=null===e||void 0===e?void 0:e.data;if(o&&o.length>0){g(o);const e=Object.keys(o[0]);m(e)}else p.oR.error("Empty or invalid CSV file"),S("/lead")}else if("xlsx"===o){const e=new Uint8Array(l.result),o=new(x().Workbook);await o.xlsx.load(e);const a=o.getWorksheet(1),s=[];if(a.eachRow({includeEmpty:!0},((e,l)=>{const o={};e.eachCell({includeEmpty:!0},((e,l)=>{o[a.getCell(1,l).value]=e.value})),s.push(o)})),null===s||void 0===s||s.splice(0,1),g(s),s&&s.length>0){const e=Object.keys(s[0]);m(e)}else p.oR.error("Empty or invalid XLSX file"),S("/lead")}},"csv"===o)l.readAsText(e);else if("xlsx"===o){const o=new Blob([e]);l.readAsArrayBuffer(o)}})(l[0])}}),[l]),(0,s.useEffect)((()=>{const e=null===t||void 0===t?void 0:t.filter((e=>{const l=null===L||void 0===L?void 0:L.find((l=>e===(null===l||void 0===l?void 0:l.accessor)||e===(null===l||void 0===l?void 0:l.Header)));return!!l&&(W(null===l||void 0===l?void 0:l.accessor,e),!0)}));F(e)}),[t]),(0,b.jsx)(b.Fragment,{children:(0,b.jsxs)(y.A,{overflowY:"auto",className:"importTable",children:[(0,b.jsx)(d.Text,{color:"secondaryGray.900",fontSize:"22px",fontWeight:"700",mb:"20px",children:"Import Leads"}),(0,b.jsx)(d.Grid,{templateColumns:"repeat(12, 1fr)",mb:3,pb:2,gap:1,borderBottom:"1px solid #e2e8f0",children:[{Header:"Fields In Crm",accessor:"crmFields"},{Header:"Fields In File",accessor:"fileFields"}].map(((e,l)=>(0,b.jsx)(d.GridItem,{colSpan:{base:6},fontWeight:"600",fontSize:{sm:"14px",lg:"14px"},color:"secondaryGray.900",style:{textTransform:"uppercase"},children:e.Header},l)))}),(0,b.jsx)(d.Grid,{templateColumns:"repeat(12, 1fr)",mb:3,gap:1,overflowY:"auto",children:null===L||void 0===L?void 0:L.map(((e,l)=>(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(d.GridItem,{colSpan:{base:6},mt:"10px",children:e.Header},e.id),(0,b.jsx)(d.GridItem,{colSpan:{base:4},children:(0,b.jsxs)(n.l6,{variant:"flushed",fontWeight:"500",isSearchable:!0,value:T[e.accessor],name:e.accessor,onChange:B,children:[(0,b.jsxs)("option",{value:"",children:[" ",C&&C.find((l=>(e.Header===l||e.accessor===l)&&l))?C.find((l=>(e.Header===l||e.accessor===l)&&l)):"Select Field In File"]}),null===t||void 0===t?void 0:t.map((e=>(0,b.jsx)("option",{value:e,children:e},e)))]})})]})))}),(0,b.jsx)(d.Flex,{Flex:!0,justifyContent:"end",mt:"5",children:(0,b.jsx)(c.Button,{size:"sm",onClick:()=>R(),variant:"brand",children:"Save"})})]})})}}}]);
//# sourceMappingURL=602.b49a530b.chunk.js.map